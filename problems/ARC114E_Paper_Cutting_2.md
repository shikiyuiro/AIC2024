<!--
author: HARADA Kento
-->
## [ARC114E Paper Cutting 2](https://atcoder.jp/contests/arc114/tasks/arc114_e)

<details><summary> ヒント1 </summary>

期待値の線形性より、答えは $h+w-2$本の直線それぞれについて、「その直線を選ぶ確率」を全て足し合わせた値になります。

</details>

<details><summary> ヒント2 </summary>

「直線 $i$ と直線 $j$ を選ぶとき、直線 $i$ を先に選ばなければならない」といった具合に、2直線間には選べる順番が決まっている場合があります。この関係をグラフで表現できないでしょうか？

</details>

<details><summary> 解説 </summary>

期待値の線形性より、答えは $h+w-2$ 本の直線それぞれについて、「操作全体を通してその直線を選ぶ確率」を全て足し合わせた値になります。したがって、ある直線に注目するとき、その直線が選ばれる確率を高速に求められればこの問題を解くことができます。

この確率を求める際、各直線を頂点とみなして有向グラフを作ると見通しが良くなります。例えば、下図左のようなマス目を右のようなグラフで表します。これは、となり合う2本の直線 $i, j$ について、「直線 $i$ と直線 $j$ を選ぶとき、直線 $i$ を先に選ばなければならない」といった関係をグラフで表したものです。ただし、選んだら操作が終わる直線に対応する頂点は強連結になるように辺を張っています。以下では直線 $i$ に対応する頂点を頂点 $i$ と呼び、直線 $i$ を選ぶことを頂点 $i$ を黒く塗るという操作で置き換えます。

![fig](https://hackmd.io/_uploads/BJFEZFfrA.png)

すると、頂点 $i$ から到達可能な頂点の中に黒く塗られたものが存在しない場合に限り、頂点 $i$ を黒く塗れることが分かります。例えば、上の例で $t1$ を塗る場合は $t2, t3, y3, y4$ が塗られる前である必要があります。

このようなグラフを用いた考察を踏まえると、操作全体を通して頂点 $i$ が黒く塗られる確率は、$1/(頂点 i から到達可能な頂点の数)$ となります。これは、頂点 $i$ から到達可能な頂点の中で、頂点 $i$ が最も早く塗られる確率を求めていると思うと分かりやすいです。例えば、上の例で $t1$ が塗られる確率は、$t1, t2, t3, y3, y4$ の中で $t1$ が最初に塗られる確率と一致するので、$1/5$ です。

他の頂点についても同様に確率を求め、足し合わせることでこの問題を解くことが出来ます。

[実装例(C++)](https://atcoder.jp/contests/arc114/submissions/54300797)

</details>
