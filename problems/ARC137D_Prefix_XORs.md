<!--
author: ISHIKAWA Yuichiro
-->
## [ARC137D Prefix XORs](https://atcoder.jp/contests/arc136/tasks/arc137_d)

<details><summary> ヒント1 </summary>

(以下、$A$は0-indexedとします。)

各 $A_{i}$ が $0$または$1$であるときに問題が解ければよいです。  
いったん、XORの累積和ではなく通常の累積和を考え、求めるべき累積和の値を二項係数を用いて表してみましょう。  

</details>

<details><summary> 問題の言い換え1 </summary>

$(1, 0, 0, 0, ..., 0)$ の累積和をk回とると、  

$\left(\binom{k-1}{0}, \binom{k + 0}{1}, \binom{k+1}{2}, \binom{k+2}{3}, ..., \binom{k + i - 1}{i}, ..., \binom{k + N - 2}{N-1}\right)$ が得られます。(証明は帰納法など。)


問題を二項係数を用いて言い換えると次のようになります。  

・$k = 1, 2, 3, ..., M$ について、  
$\binom{k-2+N}{N-1}A[0] \oplus \binom{k-2+N-1}{N-2}A[1] \oplus ... \oplus  \binom{k + 1}{0}A[N-1]$  
の値を求めよ。

さらに、偶奇に着目すると次のように言い換えられます。

 ・$k = 1, 2, 3, ..., M$ について、  
 以下の二条件をみたす ・$j = 1, 2, 3, ..., N-1$ を数え上げよ  
  ・$A[j] = 1$  
  ・$\binom{k-2+N-j}{N-1-j}$は奇数

</details>

<details><summary> ヒント2 </summary>

一般に素数$p$を法とする二項係数の mod $p$での値は<b>Lucasの定理</b>を用いて求められます。 

</details>

<details><summary> 問題の言い換え2 </summary>

一般に素数$p$を法とする二項係数の mod $p$での値は<b>Lucasの定理</b>を用いて求められます。  
特に、$p = 2$であるとき、$\binom{k-2+N-j}{N-1-j}$が奇数であるとは、$N-1-j$のビットが立っているすべての桁で$k-2+N-j$のビットが立っていることと同値です。

以上より、問題はさらに次のように言い換えられます。
$k$を固定した時に求める値は$j = 1, 2, ..., N$のうち以下の二つの条件が成り立つものの数です。  
・$A_{j}$は$1$  
・$N-1-j$のビットが立っているすべての桁で$k-2+N-j$のビットが立っている  
$\Leftrightarrow$ $N-1-j$のビットが立っている桁と$k-1$のビットが立っている桁は相異なる  
$\Leftrightarrow$ $N-1-j$のビットが立っているすべての桁で$(k-1)$の補数のビットが立っている  
</details>

<details><summary> 問題の言い換え3/最終的な実装方針 </summary>

二進数表示の整数を空間$(\mathrm{Z}/2\mathrm{Z})^{31}$ の点とみなし、そのゼータ変換を考えます。(C++におけるstd::bitset<31>と捉えるとわかりやすいかも。)以下に具体的な考え方を述べます。  
 点$N-1-j$に重み$A[j]$があると考えます。 <b>(この位置が$k$によらないのがポイント!)</b>  
 空間$(\mathrm{Z}/2\mathrm{Z})^{31}$ は31個の引数をもつdp配列と捉えられます。その配列上で重みの多次元累積XORをとります。  
 その遷移は $i = 0, 1, ..., 30$ について、
 それぞれ位置$j\oplus 2^i$の重み に 位置$j$の重みを加算する形になります。(注意: すべての点に対して計算すると間に合いません。 $10^{6} < 2^{20}$ より、実際は $i = 20$ までで打ち切ってよい。)
 このとき、各 $k = 1, 2, 3, ..., M$ について、
 位置($k-1$の補数)の累積された重みが答えになります。 <b>(この位置もまたjによらない!)</b>

</details>