<!--
author: ISHIKAWA Yuichiro
-->
## [ARC107C Shuffle Permutation](https://atcoder.jp/contests/arc125/tasks/arc107_c)

<details><summary> ヒント1 </summary>

行に関する操作と列に関する操作は独立です。  
すなわち、求める答えは行に関する並べ替えの総数と列に関する並べ替えの総数の積です。

</details>

<details><summary> ヒント2 </summary>

第$1$行と第$2$行、第$2$行と第$3$行が交換可能であるとき、いくつかの交換を組み合わせることで、  
第$1$行と第$3$行を<b>第$2$行をもとの位置に保ったまま</b>交換することができます。  
(実際、$(1,2,3)→(2,1,3)→(3,1,2)→(3,2,1)$と交換すればよい。)  
上は第$1$行と第$3$行が交換可能であるとみなしてよいことを示唆しています。

</details>

<details><summary> 解説 </summary>

一般に、第$x$行と第$y$行、第$y$行と第$z$行が交換可能であるとき、第$x$行と第$z$行もまた、交換可能とみなしてよいです。この関係はグラフの言葉で言うと、頂点$x$と頂点$y$が連結、頂点$y$と頂点$z$が連結、であるとき、頂点$x$と頂点$z$が連結であることに対応しており、したがって、その連結成分のなかで自由に並べ替えることができるとわかります。  
このような連結性の管理として、UnionFindが役立ちます。

結局、この問題ですべきことは以下の$3$つになります。  
・行のswapについて、swapが可能かどうかをUnionFindで管理する。  
・各連結成分ごとに、ありうる並べ替えは連結成分のサイズを$n$として$n!$通りある。これらの積が行に関する並べ替えの場合の数。  
・同じことを列にも考え、それらの積を求める。

</details>
