<!--
author: ISHIKAWA Yuichiro
-->
## [ARC143D Bridges](https://atcoder.jp/contests/arc143/tasks/arc143_d)

<details><summary> ヒント1a </summary>

よい性質が見つからないとき、手元で実験するのがセオリーです。
たとえば、
ケース
```
3 3
1 2 3
2 3 1
```
において、どのような01列が条件を満たすでしょうか?

</details>

<details><summary> ヒント1b </summary>

ケース
```
3 3
1 2 3
2 3 1
```
において、答えとなりうる01列は、000、あるいは111です。

さて、ある辺 $u$ が橋であることは、 $u$ の端点から端点へのパスであって、 $u$ を通らないパスが存在することと言い換えられます。

頂点1から頂点2や頂点3へのパスが存在する状態をどのようにあらわせばよいでしょうか。

</details>

<details><summary> ヒント2 </summary>

2つの対象のあいだの関係を表すために、問題として与えられたものとは別にグラフを考えましょう。

もとのグラフを$G$とおき、  
N頂点M辺の次のような有向グラフ$H$を考えます。  
・各 $i\,(0\leq i \leq M)$ について、$H$の頂点$A_{i}$と頂点$B_{i}$を結ぶ

このとき上のケースの答えに対応する$H$は3頂点のサイクルとなります。  
一般のケースに対して、  
$G$の頂点$v$と頂点$v+N$を結ぶ辺が橋でないことは、
$H$の頂点$v$があるサイクルで被覆されていること(すなわち、自己ループをもつかある2点以上の強連結成分に含まれること)と同値であり、  
$G$の頂点$A_{i}$と頂点$B_{i}+N$を結ぶ辺が橋でないことは、
$H$の頂点$A_{i}$と頂点$B_{i}$が同じ強連結成分に含まれることと同値です。

辺が橋であるという条件を頂点が(2頂点以上の)強連結成分に含まれるという条件に言い換えられました！  
もとの問題の求める01列は、新しく考えたグラフ$H$の辺の向き付けと捉えることができるため、考えるべきは辺をうまく向きつけることで$H$の頂点をなるべく多く強連結成分に含めることです。

</details>

<details><summary> 解説 </summary>

ヒント2で定義したグラフ$H$を用います。  
$H$の連結成分ごとに考えます。  
$H$の辺をうまく向きつけることで(2頂点以上の)強連結成分に含まれる頂点の個数が最大となったとしましょう。  
このとき、その最大値を保ったまま、以下のような操作ができます。  
・用いられていない辺が横断辺とならないような任意の有向全域木について、$H$のいくつかの辺の向きを変えることでその有向全域木が含まれるようにできる
(証明の概略;強連結成分内の任意の2頂点$u$,$v$について、$u$から$v$へのパスと$v$から$u$へのパスであって互いに辺素なものを取ることができる。横断辺を含まない有向全域木の各強連結成分内の2点はすべて一方がもう一方の祖先になるため、各強連結成分の中で最も根に近い頂点$p$と最も葉に近い頂点$q$をとることができ、特に$p$から$q$、$q$から$p$両方のパスが存在することからふたたび強連結にできる)  
したがって、DFS木を考え、DFS木に含まれる辺を根から葉の向きに、含まれない辺(DFS木の性質からこれは横断辺にならず、必ず後退辺になります)を葉から根の向きに向きつければよいです。

結局、やるべきことは以下にまとめられます。  
・グラフ$H$を構成する<br>
・$H$の連結成分ごとに適当な根をえらびDFS木を構築する<br>
・DFS木に含まれる辺を根から葉の向きに、含まれない辺を葉から根の向きに向きつける<br>
</details>
