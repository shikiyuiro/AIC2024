<!--
author: ISHIKAWA Yuichiro
-->
## [ARC104D Multiset Mean](https://atcoder.jp/contests/arc104/tasks/arc104_d)

<details><summary> ヒント </summary>

平均が$\mu$であることは、要素ごとの$\mu$との偏差の和が$0$であることに対応します。特に、$\mu-1$ 以下の数に対しての偏差の和と、$\mu+1$ 以上の数に対しての偏差の和が等しくなればよいです。

たとえば、$\{1, 3, 5, 5, 6\}$ の平均が $4$ であることは、  
$3$以下の数の偏差の和 $|4-1| + |4-3|$ と、  
$5$以上の数の偏差の和 $|4-5| + |4-5| + |4-6|$ が等しいことに対応します。

</details>

<details><summary> 解説 </summary>

ヒント1で挙げた 「$\mu+1$ 以上の数の偏差の和」がちょうど $S$ であるような集合の数は、多項式の積

$(1 + x + x^2 + \cdots + x^K)$  
$(1 + x^2 + x^4 + \cdots + x^{2K})$  
$\vdots$  
$(1 + x^{(N-\mu)} + x^{2(N-\mu)} + \cdots + x^{(N-\mu)K})$

の $S$ 次の項の係数に対応します。

今回の場合、任意modのため畳み込みができず一見時間がかかりそうですが、上の多項式が2項よりなる多項式どうしの商  
$(1 + x^d + x^{2d} + \cdots + x^{Kd}) = (1 - x^{(K+1)d}) / (1 - x^d)$ の形に表されることに注意すると、高速に求めることができます。

具体的には、多項式 $A_0 + A_1x + A_2x + \cdots$ に対して、  
多項式$(1 - x^t)$で割ることはその多項式の$t$項とばしの累積和$A_0 + A_1x + \cdots + (A_t + A_0)x^t + (A_{t+1} + A_1)x^{t+1} + \cdots $ を計算することにあたり、  
多項式$(1 - x^t)$をかけることはその負数バージョン
$A_0 + A_1x + \cdots + (A_t - A_0)x^t + (A_{t+1} - A_1)x^{t+1} + \cdots $ を計算することにあたります。

さて、$\mu = 1$に対して、「$\mu-1$以下の数の偏差の和」の母関数と「$\mu+1$以下の数の偏差の和」の母関数は上の方法で$\mathrm{O}(N^3K)$時間あれば計算できます。
また、$\mu = 2$ のときの母関数は、$\mu = 1$のときの母関数を計算に利用することができます。その更新にかかる計算時間は$\mathrm{O}(N^2K)$です。
$\mu = 3, 4, ...$ についても同様にして求めることができます。
$\mu$ごとに母関数がわかれば、その$\mu$に対して求める値はその母関数の同じ次数の項の係数の積の和です。
したがって、各$\mu$に対して、あわせて$\mathrm{O}(N^3K)$時間でこの問題を解くことができます。

今回の問題はFPS上の計算に慣れていないと議論を追いづらいと思います。
今回の問題を解くにあたって、とても参考になる記事を紹介します。
[多項式の積と累積和の関係についての解説](https://trap.jp/post/1657/)
</details>
